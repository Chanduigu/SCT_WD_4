<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial‑scale=1.0">
  <title>Tasks – Dharana</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="background"></div>

  <div class="todo-container">
    <h1 class="title">Your Tasks</h1>
    <ul id="taskList" class="task-list"></ul>

    <div class="nav-links">
      <a href="dashboard.html">Home</a>
      <a href="progress.html">My Progress</a>
      <a href="schedule.html">Schedule</a>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = { /* same config */ };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let user;
    onAuthStateChanged(auth, u => {
      if (!u) return location.href = "landing.html";
      user = u; loadTasks();
    });

    window.loadTasks = () => {
      const listEl = document.getElementById("taskList");
      onValue(ref(db, `tasks/${user.uid}`), snap => {
        listEl.innerHTML = '';
        snap.forEach(c => {
          const t = c.val(), k = c.key;
          const li = document.createElement('li');
          li.className = "task-item";
          li.innerHTML = `
            <input type="checkbox" ${t.completed?'checked':''} class="complete-checkbox"/>
            <input type="text" value="${t.text}" class="edit-input"/>
            <select class="edit-priority">
              <option value="High" ${t.priority==='High'?'selected':''}>High</option>
              <option value="Medium" ${t.priority==='Medium'?'selected':''}>Medium</option>
              <option value="Low" ${t.priority==='Low'?'selected':''}>Low</option>
            </select>
            <button class="save-btn">Save</button>
            <button class="delete-btn">Delete</button>
          `;

          li.querySelector('.complete-checkbox').onchange = e => {
            update(ref(db, `tasks/${user.uid}/${k}`), { completed: e.target.checked });
          };

          li.querySelector('.save-btn').onclick = () => {
            const text = li.querySelector('.edit-input').value.trim();
            const p = li.querySelector('.edit-priority').value;
            if (text) update(ref(db, `tasks/${user.uid}/${k}`), { text, priority: p });
          };

          li.querySelector('.delete-btn').onclick = () => {
            remove(ref(db, `tasks/${user.uid}/${k}`));
          };

          listEl.appendChild(li);
        });
      });
    };
  </script>
</body>
</html>
